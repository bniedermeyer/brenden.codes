{"data":{"site":{"siteMetadata":{"author":{"name":"Brenden Niedermeyer","contacts":{"twitter":"thenieds"}},"disqusShortname":"","subtitle":"","title":"Blog | Brenden Niedermeyer","url":"https://brenden.codes"}},"markdownRemark":{"id":"4f83a58d-6785-5f66-8cd2-766e2c688a12","html":"<p><strong>Note: This article was originally published on the <a href=\"https://medium.com/ngconf/best-practices-for-building-angular-schematics-419b54057383\">ng-conf Medium publication.</a></strong></p>\n<p>Angular Schematcs are one of the coolest things to come out of Angular in the past while. With a little bit of work you can build extensions for the Angular CLI that can install and setup libraries in your project, generate code, or make configuration changes easily and in a standard way. They can save you a lot of time in addition to help enforcing coding standards your organization may have.</p>\n<p>Here are some best practices that can help save you some time and headaches as you build some awesome schematics.</p>\n<h2 id=\"use-a-sandbox-project-to-test-your-schematics-functionality-as-you-develop\"><a href=\"#use-a-sandbox-project-to-test-your-schematics-functionality-as-you-develop\" aria-label=\"use a sandbox project to test your schematics functionality as you develop permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Use a sandbox project to test your schematics’ functionality as you develop</h2>\n<p>Testing the functionality of your schematics to make sure they behave the way you expect can be tricky. It usually involves having to link your project to another Angular application and then going back and resetting things after you run your schematics before you try again. This can be cumbersome and much more time than I would like. What if I told you it didn’t have to be that way?</p>\n<p><a href=\"https://www.kevinschuchard.com/blog/2018-11-20-schematic-sandbox/\">Kevin Schuchard has a great post</a> where he reccomends packaging your schematics with its own Angular app, which he calls a sandbox, and wire it up with scripts for quick testing and resetting of the project between runs. This helps you move quickly but, even better, helps others to be productive when working on your schematics later on. I highly suggest you go read the article, but here’s a quick and dirty setup of a sandbox for your schematics.</p>\n<ol>\n<li>Generate an Angular workspace with <code class=\"language-text\">ng new sandbox --skipGit</code>.</li>\n<li>Add these two scripts to the sandbox’s <code class=\"language-text\">package.json</code></li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&quot;build&quot;: &quot;ng build --prod --progress=false&quot;,\n&quot;test&quot;: &quot;ng test --watch=false&quot;</code></pre></div>\n<ol start=\"3\">\n<li>Update the scripts in the <strong>root</strong> <code class=\"language-text\">package.json</code> with the following. For this example we’ll say that we want to test our ng-add schematic.</li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">&quot;build&quot;: &quot;tsc -p tsconfig.json&quot;,\n&quot;test&quot;: &quot;npm run sandbox:ng-add &amp;&amp; npm run test:sandbox&quot;,\n&quot;clean&quot;: &quot;git checkout HEAD -- sandbox &amp;&amp; git clean -f -d sandbox&quot;,\n&quot;link:schematic&quot;: &quot;npm link &amp;&amp; cd sandbox &amp;&amp; npm link my-awesome-schematic&quot;,\n&quot;sandbox:ng-add&quot;: &quot;cd sandbox &amp;&amp; ng g my-awesome-schematic:ng-add&quot;,\n&quot;test:sandbox&quot;: &quot;cd sandbox &amp;&amp; npm run lint &amp;&amp; npm run build&quot;</code></pre></div>\n<ol start=\"4\">\n<li>Go ahead and setup/commit everything to your git repository at the root of the project (there shouldn’t be a secondary one in the sandbox). These scripts will allow us to link our schematics via <code class=\"language-text\">npm link</code> to the sandbox and execute them easily with <code class=\"language-text\">npm test</code> then clean up the sandbox back to it’s original state with <code class=\"language-text\">npm run clean</code>.</li>\n</ol>\n<h2 id=\"type-your-schemas\"><a href=\"#type-your-schemas\" aria-label=\"type your schemas permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Type your schemas</h2>\n<p>Schemas are great. They allow you to define what options your schematic is expecting and use dialogs to gather information from the user instead of forcing the user to remember various flags for your schematic. After I create a <code class=\"language-text\">schema.json</code> file for my schematics I find it helpful to create an interface that represents that schematic’s options.</p>\n<p>For example, given this schematic’s <code class=\"language-text\">schema.json</code> file:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"$schema\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://json-schema.org/schema\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"my-awesome-schematic\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"My awesome schematic\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"object\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"project\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"string\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"The name of the project.\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"$default\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n        <span class=\"token property\">\"$source\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"projectName\"</span>\n      <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"path\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"string\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"default\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./files\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"The location you want your files created\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"x-prompt\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Where would you like your files setup?\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"moduleName\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"string\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"The module the changes should be made to\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"x-prompt\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Which module would you like updated?\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"required\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"moduleName\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"additionalProperties\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>You would create a <code class=\"language-text\">schema.model.ts</code> file like so:</p>\n<div class=\"gatsby-highlight\" data-language=\"ts\"><pre class=\"language-ts\"><code class=\"language-ts\"><span class=\"token keyword\">export</span> <span class=\"token keyword\">interface</span> <span class=\"token class-name\">Schema</span> <span class=\"token punctuation\">{</span>\n  project<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  path<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n  moduleName<span class=\"token punctuation\">:</span> <span class=\"token builtin\">string</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>This way you can use this as the type of the options you pass into the rule factory and you get all the great type checking benefits of Typescriot when working with your rule factorites.</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Rule<span class=\"token punctuation\">,</span> SchematicContext<span class=\"token punctuation\">,</span> Tree <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular-devkit/schematics'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Schema <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./schema.model.ts'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">myAwesomeSchematic</span><span class=\"token punctuation\">(</span>_options<span class=\"token punctuation\">:</span> Schema<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> Rule <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>tree<span class=\"token punctuation\">:</span> Tree<span class=\"token punctuation\">,</span> _context<span class=\"token punctuation\">:</span> SchematicContext<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> tree<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"organize-your-project-by-schematic\"><a href=\"#organize-your-project-by-schematic\" aria-label=\"organize your project by schematic permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Organize your project by schematic</h2>\n<p>This may seem like a no-brainer, even the example project gernerated when you run <code class=\"language-text\">schematics schematic</code> organizes files like this, but it really is the best way to organize your schematics and adhereing to this will save you a lot of headache down the road. For example if my project had three different schematics (let’s call them schematic-a, schematic-b, and schematic-c) you should organize your project like so:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\">src\n├── collection.json\n├── schematic-a\n│   ├── files\n│   │   ├── file-1.txt\n│   │   └── file-2.txt\n│   ├── index.ts\n│   ├── index_spec.ts\n│   ├── schema.json\n│   └── schema.model.ts\n├── schematic-b\n│   ├── index.ts\n│   ├── index_spec.ts\n│   ├── schema.json\n│   └── schema.model.ts\n└── schematic-c\n    ├── index.ts\n    ├── index_spec.ts\n    ├── schema.json\n    └── schema.model.ts</code></pre></div>\n<p>This is similar to how the Angular style guide reccomends organizing your projects into modules by feature.</p>\n<h2 id=\"create-helper-schematics\"><a href=\"#create-helper-schematics\" aria-label=\"create helper schematics permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Create helper schematics</h2>\n<p>The great thing about schematics is that they can call other schematics! This means you can split up your funcitonality among multiple schematics and make them more modular. For example if I had a schematic that installed some libraries then\nmodified something in the file tree I would create one schematic to handle the installation of the dependencies, one to deal with the file system interactions, and a third to serve as the main schematic that chains the previous two.</p>\n<p>Here is what the primary schematic would look like:</p>\n<div class=\"gatsby-highlight\" data-language=\"typescript\"><pre class=\"language-typescript\"><code class=\"language-typescript\"><span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span>\n  Rule<span class=\"token punctuation\">,</span>\n  SchematicContext<span class=\"token punctuation\">,</span>\n  Tree<span class=\"token punctuation\">,</span>\n  chain\n<span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'@angular-devkit/schematics'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">import</span> <span class=\"token punctuation\">{</span> Schema <span class=\"token punctuation\">}</span> <span class=\"token keyword\">from</span> <span class=\"token string\">'./schema.model.ts'</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">export</span> <span class=\"token keyword\">function</span> <span class=\"token function\">myAwesomeSchematic</span><span class=\"token punctuation\">(</span>_options<span class=\"token punctuation\">:</span> Schema<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> Rule <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>tree<span class=\"token punctuation\">:</span> Tree<span class=\"token punctuation\">,</span> _context<span class=\"token punctuation\">:</span> SchematicContext<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    <span class=\"token keyword\">return</span> <span class=\"token function\">chain</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">[</span>\n      <span class=\"token function\">addDependencies</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span>\n      <span class=\"token function\">addRequiredFiles</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">)</span>\n    <span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">(</span>tree<span class=\"token punctuation\">,</span> _context<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">addDependencies</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">:</span> Schema<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> Rule <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>tree<span class=\"token punctuation\">:</span> Tree<span class=\"token punctuation\">,</span> _context<span class=\"token punctuation\">:</span> SchematicContext<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    _context<span class=\"token punctuation\">.</span><span class=\"token function\">addTask</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RunSchematicTask</span><span class=\"token punctuation\">(</span><span class=\"token string\">'add-dependencies'</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> tree<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">function</span> <span class=\"token function\">addRequiredFiles</span><span class=\"token punctuation\">(</span>options<span class=\"token punctuation\">:</span> Schema<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span> Rule <span class=\"token punctuation\">{</span>\n  <span class=\"token keyword\">return</span> <span class=\"token punctuation\">(</span>tree<span class=\"token punctuation\">:</span> Tree<span class=\"token punctuation\">,</span> _context<span class=\"token punctuation\">:</span> SchematicContext<span class=\"token punctuation\">)</span> <span class=\"token operator\">=></span> <span class=\"token punctuation\">{</span>\n    _context<span class=\"token punctuation\">.</span><span class=\"token function\">addTask</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">new</span> <span class=\"token class-name\">RunSchematicTask</span><span class=\"token punctuation\">(</span><span class=\"token string\">'add-files'</span><span class=\"token punctuation\">,</span> options<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> tree<span class=\"token punctuation\">;</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>Then in <code class=\"language-text\">collection.json</code> you can mark those other two schematics as private so they aren’t accessable outside of the schematic:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"$schema\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"../node_modules/@angular-devkit/schematics/collection-schema.json\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"schematics\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"bootstrap-project\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Main entry point for the schematic. Calls additional schematics and coordinates their operation\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"factory\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./bootstrap-project/index\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"schema\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./bootstrap-project/schema.json\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"add-dependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Install dependencies for the setup process\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"private\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"factory\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./add-dependencies/index\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"schema\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./add-dependencies/schema.json\"</span>\n    <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"add-files\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n      <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"Performs additional setup actions for configuring the project.\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"private\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"factory\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./add-files/index\"</span><span class=\"token punctuation\">,</span>\n      <span class=\"token property\">\"schema\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./add-files/schema.json\"</span>\n    <span class=\"token punctuation\">}</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<h2 id=\"use-the-files-property-of-packagejson-to-only-publish-what-you-want\"><a href=\"#use-the-files-property-of-packagejson-to-only-publish-what-you-want\" aria-label=\"use the files property of packagejson to only publish what you want permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Use the <code class=\"language-text\">files</code> property of <code class=\"language-text\">package.json</code> to only publish what you want</h2>\n<p>As your project grows and becomes more complex you might have more files and directories added to it. This can be great and ease our lives as developers but a lot of that other stuff we use for developing our schematics should not be packaged with the schematics when we publish to npm for others to use (our fancy new sandbox for example). Those files will never be used by end users and can bloat the footprint of our schematics package.</p>\n<p>Luckily theres a way to keep our publish process small and simple without needing to change a lot to the project. Simply add the directories you want published to a <code class=\"language-text\">files</code> array in your <code class=\"language-text\">package.json</code> and let npm take care of the rest! For example, if I only wanted to publish my <code class=\"language-text\">src</code> directory when I released my schematics package I would first create a <code class=\"language-text\">.npmignore</code> that ensures that none of your *.ts except for definition files will be packaged:</p>\n<div class=\"gatsby-highlight\" data-language=\"text\"><pre class=\"language-text\"><code class=\"language-text\"># Ignores TypeScript files, but keeps definitions.\n*.ts\n!*.d.ts</code></pre></div>\n<p>Then update the <strong>root</strong> <code class=\"language-text\">package.json</code> like so:</p>\n<div class=\"gatsby-highlight\" data-language=\"json\"><pre class=\"language-json\"><code class=\"language-json\"><span class=\"token punctuation\">{</span>\n  <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"my-schematic\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"0.0.0\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"description\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"A blank schematics\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"scripts\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"build\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"tsc -p tsconfig.json\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"test\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"npm run build &amp;&amp; jasmine src/**/*_spec.js\"</span>\n  <span class=\"token punctuation\">}</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"keywords\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"schematics\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"files\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"src\"</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> &lt;-- this is the field you add\n  <span class=\"token property\">\"license\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"MIT\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"schematics\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"./src/collection.json\"</span><span class=\"token punctuation\">,</span>\n  <span class=\"token property\">\"dependencies\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token property\">\"@angular-devkit/core\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^7.3.1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@angular-devkit/schematics\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^7.3.1\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@types/jasmine\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^3.0.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"@types/node\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^8.0.31\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"jasmine\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"^3.0.0\"</span><span class=\"token punctuation\">,</span>\n    <span class=\"token property\">\"typescript\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"~3.2.2\"</span>\n  <span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Adding this additional field will tell npm to only package those files that are not ignored within the <code class=\"language-text\">src</code> directory. Hooray smaller package sizes!</p>\n<h2 id=\"conclusion\"><a href=\"#conclusion\" aria-label=\"conclusion permalink\" class=\"anchor\"><svg aria-hidden=\"true\" focusable=\"false\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>Conclusion</h2>\n<p>Schematics are very exciting and very powerful. There are a lot of techniques that can help to make the building of schematics a lot less difficult. Now you have a few more tools in your schematics toolbox to make sure you can build maintainable and highly performing schematics for your projects. Go forth and see what you can create!</p>","fields":{"slug":"/posts/angular-schematics-best-practices/","tagSlugs":["/tag/angular/","/tag/libraries/","/tag/web-development/","/tag/angular-cli/","/tag/angular-schematics/","/tag/type-script/"]},"frontmatter":{"date":"2019-02-27T22:40:32.169Z","description":"Thoughts on best practices to use when building custom Angular Schematics","tags":["Angular","Libraries","Web Development","Angular CLI","Angular Schematics","TypeScript"],"title":"Best Practices for building Angular Schematics"}}},"pageContext":{"slug":"/posts/angular-schematics-best-practices/"}}